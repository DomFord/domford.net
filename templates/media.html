{% extends "base.html" %}

{% block content %}

{% set pages = section.pages | sort(attribute="date", reverse=true) %}
{% set grouped = pages | group_by(attribute="year") %}

<div class="page-publications">

  {# Collect years #}
  {% set years = [] %}
  {% for y, _items in grouped %}
    {% set_global years = years | concat(with=[y]) %}
  {% endfor %}
  {% set years = years | sort | reverse %}

  {% for year in years %}
    {% set items = grouped[year] %}

    <section class="pub-year-row" aria-labelledby="year-{{ year }}">
      <div class="pub-year-col" id="year-{{ year }}">
        <span class="pub-year">{{ year }}</span>
      </div>

      <div class="pub-content">
        <ul class="pub-list">

          {% for page in items | sort(attribute="date") | reverse %}
            <li class="pub-item">

              {% if page.extra.type %}
                <div class="pub-type">{{ page.extra.type | safe }}</div>
              {% endif %}

              <div class="pub-title">
                {% if page.extra.title_html %}
                  {{ page.extra.title_html | safe }}
                {% else %}
                  {{ page.title }}
                {% endif %}
              </div>

              <div class="pub-venue">
                {% if page.extra.venue %}
                  <em>{{ page.extra.venue }}</em>
                {% endif %}
                {% if page.extra.place %}
                  ({{ page.extra.place }})
                {% endif %}
              </div>

              <div class="pub-authors">{{ page.extra.all_authors }}</div>

              {% if page.content %}
                <details class="pub-abstract">
                  <summary><span class="abstract-label">Summary</span></summary>
                  <div class="pub-abstract-text">
                    <div class="pub-abstract-inner">
                      {{ page.content | safe }}
                    </div>
                  </div>
                </details>
              {% endif %}

              <div class="pub-icon">
                {% if page.extra.doi %}
                  <a href="https://doi.org/{{ page.extra.doi }}" aria-label="DOI" class="icon link"></a>
                {% elif page.extra.url %}
                  <a href="{{ page.extra.url }}" aria-label="URL" class="icon link"></a>
                {% endif %}
              </div>

            </li>
          {% endfor %}

        </ul>
      </div>
    </section>

  {% endfor %}
</div>

{% endblock %}
