{% extends "base.html" %}

{% block content %}

{% set pages = section.pages | sort(attribute="date", reverse=true) %}
{% set grouped = pages | group_by(attribute="year") %}

  <div class="content page-publications col-9">

    {% set years = [] %}
    {% for y, _items in grouped %}
      {% set_global years = years | concat(with=[y]) %}
    {% endfor %}
    {% set years = years | sort | reverse %}

    {% for year in years %}
      {% set items = grouped[year] %}

      <section class="pub-year-row" aria-labelledby="year-{{ year }}">
        <div class="pub-year-col" id="year-{{ year }}">
          <span class="pub-year">{{ year }}</span>
        </div>

        <div class="pub-content">
          <ul class="pub-list">
            {% set sorted_items = items | sort(attribute="date") | reverse %}
            {% for page in sorted_items %}
              {% set is_last = loop.index == sorted_items | length %}
              <li class="pub-item{% if is_last %} pub-item-last{% endif %}">
                {% if page.extra.type is defined %}
                  <div class="pub-type">{{ page.extra.type | safe }}</div>
                {% endif %}

                <div class="pub-title">
                  {% if page.extra.title_html is defined %}
                    {{ page.extra.title_html | safe }}
                  {% else %}
                    {{ page.title }}
                  {% endif %}
                </div>

                <div class="pub-venue">
                  {% if page.extra.conference %}
                    {{ page.extra.conference }}, {{ page.extra.place }}
                  {% elif page.extra.venue %}
                    <em>{{ page.extra.venue }}</em>
                  {% endif %}
                </div>

                <div class="pub-authors">
                  {% if page.authors %}
                    {{ page.extra.all_authors }}
                  {% else %}
                    {{ page.extra.all_editors }}
                  {% endif %}
                </div>

                {% if page.content %}
                  <details class="pub-abstract">
                    <summary><span class="abstract-label">Abstract</span></summary>
                    <div class="pub-abstract-text">
                      <div class="pub-abstract-inner">
                        {{ page.content | safe }}
                      </div>
                    </div>
                  </details>
                {% endif %}

                {% if page.extra.citation %}
                  <div class="pub-citation">{{ page.extra.citation | safe }}</div>
                {% endif %}

                <div class="pub-icon">
                  {% if page.extra.doi %}
                    <a href="https://doi.org/{{ page.extra.doi }}" aria-label="DOI" class="icon link"></a>
                  {% elif page.extra.url %}
                    <a href="{{ page.extra.url }}" aria-label="URL" class="icon link"></a>
                  {% endif %}
                </div>
              </li>
            {% endfor %}
          </ul>
        </div>
      </section>

    {% endfor %}
  </div>

{% endblock %}
